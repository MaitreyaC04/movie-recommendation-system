<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Preferences</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{{ url_for('static', filename='js/validation.js') }}"></script>
</head>
<body>
<nav style="display:flex; justify-content:space-between; 
            align-items:center; padding:10px 20px; 
            background-color:#222; color:#ffcc00;">
    
    <!-- Left: Logo -->
    <div style="font-size:32px; font-weight:bold">
        CineMatch
    </div>
    
    <!-- Right: Logout -->
    <div>
        <a href="{{ url_for('auth.logout') }}" 
           style="background:red; color:white; text-decoration:none; 
                  padding:8px 15px; border:1px solid white; 
                  border-radius:5px;">
            Logout
        </a>
    </div>
</nav>

{% include '_messages.html' %}

<div class="max-w-3xl mx-auto p-8" x-data="preferencesForm()">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Set Your Preferences</h2>

    <form action="{{ url_for('auth.set_preferences') }}" method="POST" class="bg-white shadow-lg rounded-xl p-6 space-y-6">

        <!-- Languages -->
        <div>
            <label class="block text-gray-700 mb-3">Languages</label>
            <div class="flex flex-wrap gap-3">
                {% for lang in languages %}
                <button type="button" 
                        @click="toggleSelection('languages', '{{ lang }}')" 
                        :class="selected.languages.includes('{{ lang }}') 
                            ? 'bg-yellow-500 text-white' 
                            : 'bg-gray-200 text-gray-700'"
                        class="px-4 py-2 rounded-full text-sm font-medium shadow-md transition flex items-center gap-2">
                    
                    <span>{{ lang }}</span>
                    <span x-show="selected.languages.includes('{{ lang }}')" class="text-xs">✓</span>
                </button>
                {% endfor %}
            </div>
            <input type="hidden" name="languages" :value="selected.languages.join(',')">
        </div>

        <!-- Genres -->
        <div>
            <label class="block text-gray-700 mb-3">Genres</label>
            <div class="flex flex-wrap gap-3">
                {% for genre in genres %}
                <button type="button" 
                        @click="toggleSelection('genres', '{{ genre }}')" 
                        :class="selected.genres.includes('{{ genre }}') 
                            ? 'bg-yellow-500 text-white' 
                            : 'bg-gray-200 text-gray-700'"
                        class="px-4 py-2 rounded-full text-sm font-medium shadow-md transition flex items-center gap-2">
                    
                    <span>{{ genre }}</span>
                    <span x-show="selected.genres.includes('{{ genre }}')" class="text-xs">✓</span>
                </button>
                {% endfor %}
            </div>
            <input type="hidden" name="genres" :value="selected.genres.join(',')">
        </div>

        <!-- Submit -->
        <button type="submit" 
                class="w-full py-3 bg-yellow-400 text-gray-900 font-bold rounded-lg shadow-md hover:bg-yellow-500 transition">
            Save Preferences
        </button>
    </form>
</div>

<!-- Alpine.js -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
function preferencesForm() {
    return {
        selected: { languages: [], genres: [] },
        toggleSelection(type, value) {
            if (this.selected[type].includes(value)) {
                this.selected[type] = this.selected[type].filter(v => v !== value);
            } 
            else {
                this.selected[type].push(value);
            }
        }
    }
}
</script>
</body>
</html>
